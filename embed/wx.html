<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">  
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>HKU-PGSA WeChat Articles</title>
        <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
        <link type="text/css" rel="stylesheet" href="/css/wx-card.css">

    </head>
    <body>
        <div class="container articles">
            <div class="articles-heading">
                <h2>HKU-PGSA 港大研會</h2>
                <div class="spinner"></div>
            </div>
            

        </div>
        <div class="container article-foot" style="margin: auto;"><p>
            <a href="#" >Follow our WeChat to see more</a>
        </p></div>
        <script src="/js/pgsa-apps.js"></script>
        <script>
            var _pg = _pg || {};
            _pg.sec = 's'; _pg.ver = 'v1.0.1';
            _pg.refresh = false; // true; //
            _pg.purge = true;
            _pg.init &&  (_pg.ready = _pg.init()) &&  (_pg.enc['dummy'] = 'secret');
            
            

            var params = getQueryFromURL(location.href);
            var _sep = 'sep' in params? params['sep']: ',';
            var sheet_json = 'json' in params? params['json'].split(','): [];
            var articles = 'articles' in params ? params['articles'].split(_sep): [];
            _pg.heading = 'heading' in params ? decodeURIComponent(params['heading']): 'HKU-PGSA 港大研會';
            _pg.order = 'order' in params? params['order']: 'descending';
            _pg.limit = 'limit' in params? params['limit']: 0;
            
            document.querySelector('.articles h2').innerHTML = _pg.heading;

            const li = $('div.articles');
            if(_pg.ready){
                let info;
                if(sheet_json.length == 3){
                    _pg.log('auto load from sheet ...');
                    let [ss_id, s_num, cell] = sheet_json;
                    $.ajax(`/feeds/cells/${ss_id}/${s_num}/public/basic/${cell}?alt=json`).then((data)=>{
                        articles = data.entry.content.$t.split(',');
                        articles = articles.filter((e,i,arr)=>arr.indexOf(e)==i);
                        _pg.log('obtained unique ', articles);
                        if(_pg.limit>0){
                            articles = articles.slice(-_pg.limit);
                        }
                        info = articles.map((e)=>_pg.retrieveArticle(e));
                        _pg.load_articles(li, info);
                        

                    }).catch((err)=>[]);
                }else{
                    info = articles.map((e)=>_pg.retrieveArticle(e));
                    _pg.load_articles(li, info);
                }
                
            }
            


        </script>
    </body>
</html>
